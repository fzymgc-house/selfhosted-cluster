# code: language=ansible

- name: Install Longhorn
  kubernetes.core.helm:
    kubeconfig: "/Users/sean/.kube/configs/{{ k8s_context }}-admin.yml"
    state: present
    name: longhorn
    chart_ref: longhorn
    chart_repo_url: https://charts.longhorn.io/
    chart_version: 1.8.1
    namespace: longhorn-system
    create_namespace: true
    values:
      persistence:
        defaultClassReplicaCount: 2
        defaultDataLocality: best-effort
        volumeBindingMode: WaitForFirstConsumer
      defaultSettings:
        defaultDataPath: /data/longhorn
        snapshotMaxCount: 10
        defaultReplicaCount: 2
  become: false
  run_once: true
  delegate_to: localhost
