# Teleport Helm values for standalone mode with PostgreSQL backend
# Chart: teleport-cluster from https://charts.releases.teleport.dev

chartMode: standalone

clusterName: teleport.fzymgc.house
publicAddr:
  - teleport.fzymgc.house:443

proxyListenerMode: multiplex

# Kubernetes service configuration
service:
  type: LoadBalancer
  spec:
    loadBalancerIP: ""  # Will be assigned by MetalLB

# Use existing service account (created by rbac.yaml)
serviceAccount:
  create: false
  name: teleport

# PostgreSQL backend (instead of etcd)
persistence:
  enabled: false  # Don't use PVC, use PostgreSQL

auth:
  teleportConfig:
    storage:
      type: postgresql
      conn_string: "postgres://teleport@teleport-db-rw.teleport.svc.cluster.local:5432/teleport?sslmode=disable"
      # Password provided via environment variable from secret

# Authentication configuration
authentication:
  type: oidc
  connectorName: authentik
  localAuth: true  # Allow local auth as fallback

# OIDC Connector configuration
# Note: client_secret comes from environment variable
proxySettings:
  oidcConnector:
    name: authentik
    display: "Authentik SSO"
    redirectURL: "https://teleport.fzymgc.house/v1/webapi/oidc/callback"
    issuerURL: "https://auth.fzymgc.house/application/o/teleport/"
    clientID: "teleport"
    claimsToRoles:
      - claim: groups
        value: teleport-admins
        roles:
          - admin
      - claim: groups
        value: teleport-users
        roles:
          - access

# Environment variables from secrets
extraEnv:
  - name: TELEPORT_STORAGE_PASSWORD
    valueFrom:
      secretKeyRef:
        name: teleport-db-credentials
        key: password
  - name: TELEPORT_OIDC_CLIENT_SECRET
    valueFrom:
      secretKeyRef:
        name: teleport-oidc
        key: client_secret

# TLS - use cert-manager issued certificate
tls:
  existingSecretName: teleport-tls

# Kubernetes access configuration
kubernetes:
  enabled: true
  publicAddr:
    - teleport.fzymgc.house:443

# SSH service - handled by node agents, not the cluster
sshService:
  enabled: false

# Resource limits for homelab
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    memory: 512Mi

# Single replica for homelab
highAvailability:
  replicaCount: 1

# Logging
log:
  level: INFO
