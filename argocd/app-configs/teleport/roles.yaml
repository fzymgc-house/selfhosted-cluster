---
# Teleport role definitions
# These are stored as ConfigMaps for reference and applied via tctl after deployment
#
# To apply these roles after Teleport is running:
#   kubectl --context fzymgc-house exec -n teleport deploy/teleport-auth -- \
#     tctl create -f /dev/stdin < <(kubectl --context fzymgc-house get cm teleport-roles -n teleport -o jsonpath='{.data.admin-role\.yaml}')
#   kubectl --context fzymgc-house exec -n teleport deploy/teleport-auth -- \
#     tctl create -f /dev/stdin < <(kubectl --context fzymgc-house get cm teleport-roles -n teleport -o jsonpath='{.data.access-role\.yaml}')
#
# Or copy and apply locally:
#   kubectl --context fzymgc-house get cm teleport-roles -n teleport -o jsonpath='{.data.admin-role\.yaml}' | tctl create -f -
apiVersion: v1
kind: ConfigMap
metadata:
  name: teleport-roles
  namespace: teleport
data:
  admin-role.yaml: |
    kind: role
    version: v7
    metadata:
      name: admin
    spec:
      options:
        max_session_ttl: 12h
      allow:
        logins: ["root", "admin", "sean"]
        node_labels:
          "*": "*"
        kubernetes_groups:
          - system:masters
        kubernetes_labels:
          "*": "*"
        kubernetes_resources:
          - kind: "*"
            namespace: "*"
            name: "*"
            verbs: ["*"]
        rules:
          - resources: ["*"]
            verbs: ["*"]
  access-role.yaml: |
    kind: role
    version: v7
    metadata:
      name: access
    spec:
      options:
        max_session_ttl: 8h
      allow:
        logins: ["sean"]
        node_labels:
          env: production
        kubernetes_groups:
          - view
        kubernetes_labels:
          "*": "*"
        kubernetes_resources:
          - kind: pod
            namespace: "*"
            name: "*"
            verbs: ["get", "list", "watch"]
          - kind: deployment
            namespace: "*"
            name: "*"
            verbs: ["get", "list", "watch"]
