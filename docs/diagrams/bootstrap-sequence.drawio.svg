<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1200" height="700" viewBox="-0.5 -0.5 1200 700" style="background-color: white;">
  <defs/>
  <!-- Bootstrap Sequence: Nodes Ready → ArgoCD Handoff -->

  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" font-family="Helvetica" font-size="20" font-weight="bold" fill="#333">Bootstrap Sequence</text>
  <text x="600" y="50" text-anchor="middle" font-family="Helvetica" font-size="12" fill="#666">Nodes Ready → ArgoCD Handoff</text>

  <!-- Lane Headers -->
  <rect x="40" y="70" width="360" height="40" fill="#E3F2FD" stroke="#1976D2" stroke-width="2" rx="5"/>
  <text x="220" y="95" text-anchor="middle" font-family="Helvetica" font-size="14" font-weight="bold" fill="#1976D2">Ansible: k3s-playbook.yml</text>

  <rect x="420" y="70" width="360" height="40" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="2" rx="5"/>
  <text x="600" y="95" text-anchor="middle" font-family="Helvetica" font-size="14" font-weight="bold" fill="#7B1FA2">Terraform: cluster-bootstrap</text>

  <rect x="800" y="70" width="360" height="40" fill="#E8F5E9" stroke="#388E3C" stroke-width="2" rx="5"/>
  <text x="980" y="95" text-anchor="middle" font-family="Helvetica" font-size="14" font-weight="bold" fill="#388E3C">GitOps Handoff</text>

  <!-- Starting Node: Prepared Nodes -->
  <rect x="60" y="130" width="320" height="50" fill="#ECEFF1" stroke="#607D8B" stroke-width="2" rx="8"/>
  <text x="220" y="152" text-anchor="middle" font-family="Helvetica" font-size="11" font-weight="bold" fill="#37474F">Prepared Nodes</text>
  <text x="220" y="168" text-anchor="middle" font-family="Helvetica" font-size="10" fill="#607D8B">tpi-alpha-1..4, tpi-beta-1..4</text>

  <!-- Ansible Phase Boxes -->
  <rect x="80" y="200" width="280" height="35" fill="#BBDEFB" stroke="#1976D2" stroke-width="1.5" rx="5"/>
  <text x="220" y="222" text-anchor="middle" font-family="Helvetica" font-size="11" fill="#0D47A1">k3s-storage (BTRFS mounts)</text>

  <rect x="80" y="245" width="280" height="35" fill="#BBDEFB" stroke="#1976D2" stroke-width="1.5" rx="5"/>
  <text x="220" y="267" text-anchor="middle" font-family="Helvetica" font-size="11" fill="#0D47A1">k3s-server (first control plane)</text>

  <rect x="80" y="290" width="280" height="35" fill="#90CAF9" stroke="#1565C0" stroke-width="2" rx="5"/>
  <text x="220" y="312" text-anchor="middle" font-family="Helvetica" font-size="11" font-weight="bold" fill="#0D47A1">kube-vip (API HA: 192.168.20.140)</text>

  <rect x="80" y="335" width="280" height="35" fill="#BBDEFB" stroke="#1976D2" stroke-width="1.5" rx="5"/>
  <text x="220" y="357" text-anchor="middle" font-family="Helvetica" font-size="11" fill="#0D47A1">k3s-server (join additional CP)</text>

  <rect x="80" y="380" width="280" height="35" fill="#BBDEFB" stroke="#1976D2" stroke-width="1.5" rx="5"/>
  <text x="220" y="402" text-anchor="middle" font-family="Helvetica" font-size="11" fill="#0D47A1">k3s-agent (join workers)</text>

  <rect x="80" y="425" width="280" height="35" fill="#BBDEFB" stroke="#1976D2" stroke-width="1.5" rx="5"/>
  <text x="220" y="447" text-anchor="middle" font-family="Helvetica" font-size="11" fill="#0D47A1">calico (CNI + NetworkPolicy)</text>

  <rect x="80" y="470" width="280" height="35" fill="#BBDEFB" stroke="#1976D2" stroke-width="1.5" rx="5"/>
  <text x="220" y="492" text-anchor="middle" font-family="Helvetica" font-size="11" fill="#0D47A1">longhorn-disks (storage prep)</text>

  <!-- Arrows between Ansible boxes -->
  <path d="M 220 180 L 220 200" stroke="#1976D2" stroke-width="2" fill="none" marker-end="url(#arrowBlue)"/>
  <path d="M 220 235 L 220 245" stroke="#1976D2" stroke-width="2" fill="none"/>
  <path d="M 220 280 L 220 290" stroke="#1976D2" stroke-width="2" fill="none"/>
  <path d="M 220 325 L 220 335" stroke="#1976D2" stroke-width="2" fill="none"/>
  <path d="M 220 370 L 220 380" stroke="#1976D2" stroke-width="2" fill="none"/>
  <path d="M 220 415 L 220 425" stroke="#1976D2" stroke-width="2" fill="none"/>
  <path d="M 220 460 L 220 470" stroke="#1976D2" stroke-width="2" fill="none"/>

  <!-- Terraform Phase Boxes -->
  <rect x="460" y="200" width="280" height="35" fill="#E1BEE7" stroke="#7B1FA2" stroke-width="1.5" rx="5"/>
  <text x="600" y="222" text-anchor="middle" font-family="Helvetica" font-size="11" fill="#4A148C">cert-manager</text>

  <rect x="460" y="250" width="280" height="35" fill="#E1BEE7" stroke="#7B1FA2" stroke-width="1.5" rx="5"/>
  <text x="600" y="272" text-anchor="middle" font-family="Helvetica" font-size="11" fill="#4A148C">External Secrets + Vault auth</text>

  <rect x="460" y="300" width="280" height="35" fill="#E1BEE7" stroke="#7B1FA2" stroke-width="1.5" rx="5"/>
  <text x="600" y="322" text-anchor="middle" font-family="Helvetica" font-size="11" fill="#4A148C">Longhorn (distributed storage)</text>

  <rect x="460" y="350" width="280" height="35" fill="#E1BEE7" stroke="#7B1FA2" stroke-width="1.5" rx="5"/>
  <text x="600" y="372" text-anchor="middle" font-family="Helvetica" font-size="11" fill="#4A148C">MetalLB (load balancer)</text>

  <rect x="460" y="400" width="280" height="35" fill="#CE93D8" stroke="#6A1B9A" stroke-width="2" rx="5"/>
  <text x="600" y="422" text-anchor="middle" font-family="Helvetica" font-size="11" font-weight="bold" fill="#4A148C">ArgoCD</text>

  <!-- Arrows between Terraform boxes -->
  <path d="M 600 235 L 600 250" stroke="#7B1FA2" stroke-width="2" fill="none"/>
  <path d="M 600 285 L 600 300" stroke="#7B1FA2" stroke-width="2" fill="none"/>
  <path d="M 600 335 L 600 350" stroke="#7B1FA2" stroke-width="2" fill="none"/>
  <path d="M 600 385 L 600 400" stroke="#7B1FA2" stroke-width="2" fill="none"/>

  <!-- Handoff Phase Boxes -->
  <rect x="820" y="200" width="320" height="50" fill="#C8E6C9" stroke="#388E3C" stroke-width="1.5" rx="5"/>
  <text x="980" y="222" text-anchor="middle" font-family="Helvetica" font-size="11" fill="#1B5E20">ArgoCD syncs argocd/app-configs/*</text>
  <text x="980" y="238" text-anchor="middle" font-family="Helvetica" font-size="10" fill="#388E3C">Authentik, Grafana, Windmill, etc.</text>

  <rect x="820" y="280" width="320" height="50" fill="#81C784" stroke="#2E7D32" stroke-width="2" rx="8"/>
  <text x="980" y="305" text-anchor="middle" font-family="Helvetica" font-size="14" font-weight="bold" fill="#1B5E20">✅ Cluster Operational</text>
  <text x="980" y="322" text-anchor="middle" font-family="Helvetica" font-size="10" fill="#2E7D32">GitOps manages all changes</text>

  <!-- Cross-lane arrows -->
  <path d="M 360 490 L 410 490 L 410 217 L 460 217" stroke="#546E7A" stroke-width="2" fill="none" stroke-dasharray="5,3"/>
  <polygon points="460,217 450,212 450,222" fill="#546E7A"/>

  <path d="M 740 417 L 770 417 L 770 225 L 820 225" stroke="#546E7A" stroke-width="2" fill="none" stroke-dasharray="5,3"/>
  <polygon points="820,225 810,220 810,230" fill="#546E7A"/>

  <path d="M 980 250 L 980 280" stroke="#388E3C" stroke-width="2" fill="none"/>
  <polygon points="980,280 975,270 985,270" fill="#388E3C"/>

  <!-- Legend -->
  <rect x="40" y="550" width="320" height="120" fill="#FAFAFA" stroke="#E0E0E0" stroke-width="1" rx="5"/>
  <text x="55" y="570" font-family="Helvetica" font-size="11" font-weight="bold" fill="#333">Legend</text>

  <rect x="55" y="580" width="20" height="12" fill="#BBDEFB" stroke="#1976D2"/>
  <text x="85" y="590" font-family="Helvetica" font-size="10" fill="#333">Ansible (k3s-playbook.yml)</text>

  <rect x="55" y="600" width="20" height="12" fill="#E1BEE7" stroke="#7B1FA2"/>
  <text x="85" y="610" font-family="Helvetica" font-size="10" fill="#333">Terraform (cluster-bootstrap)</text>

  <rect x="55" y="620" width="20" height="12" fill="#C8E6C9" stroke="#388E3C"/>
  <text x="85" y="630" font-family="Helvetica" font-size="10" fill="#333">ArgoCD (GitOps)</text>

  <rect x="55" y="640" width="20" height="12" fill="#ECEFF1" stroke="#607D8B"/>
  <text x="85" y="650" font-family="Helvetica" font-size="10" fill="#333">Infrastructure/Hardware</text>

  <!-- Notes -->
  <rect x="400" y="550" width="360" height="120" fill="#FFF8E1" stroke="#FFB300" stroke-width="1" rx="5"/>
  <text x="415" y="570" font-family="Helvetica" font-size="11" font-weight="bold" fill="#FF6F00">Key Points</text>
  <text x="415" y="590" font-family="Helvetica" font-size="10" fill="#333">• Ansible phases execute sequentially</text>
  <text x="415" y="605" font-family="Helvetica" font-size="10" fill="#333">• kube-vip must be up before additional nodes join</text>
  <text x="415" y="620" font-family="Helvetica" font-size="10" fill="#333">• Terraform runs from workstation with kubectl</text>
  <text x="415" y="635" font-family="Helvetica" font-size="10" fill="#333">• ArgoCD is last bootstrap component</text>
  <text x="415" y="650" font-family="Helvetica" font-size="10" fill="#333">• After ArgoCD: all changes via GitOps</text>
</svg>
