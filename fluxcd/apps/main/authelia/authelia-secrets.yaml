apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: authelia-secrets
  namespace: authelia
spec:
  refreshPolicy: Periodic
  refreshInterval: 1h
  secretStoreRef:
    name: vault
    kind: ClusterSecretStore
  target:
    template:
      name: authelia-secrets
      creationPolicy: Owner
      data:
        authentication.ldap.password.txt: "{{ .authentication_ldap_password }}"
        duo.key: "{{ .duo_key }}"
        identity_validation.reset_password.jwt.hmac.key: "{{ .identity_validation_reset_password_jwt_hmac_key }}"
        identity_providers.oidc.hmac.key: "{{ .identity_providers_oidc_hmac_key }}"
        notifier.smtp.password.txt: "{{ .notifier_smtp_password }}"
        session.encryption.key: "{{ .session_encryption_key }}"
        session.redis.password.txt: "{{ .session_redis_password }}"
        storage.postgres.password.txt: "{{ .storage_postgres_password }}"
        storage.encryption.key: "{{ .storage_encryption_key }}"
  data:
    - secretKey: authentication_ldap_password
      remoteRef:
        key: "fzymgc-house/cluster/authelia"
        property: "authentication.ldap.password"
    - secretKey: duo_key
      remoteRef:
        key: "fzymgc-house/cluster/authelia"
        property: "duo.key"
    - secretKey: notifier_smtp_password
      remoteRef:
        key: "fzymgc-house/cluster/authelia"
        property: "notifier.smtp.password"
    - secretKey: identity_providers_oidc_hmac_key
      remoteRef:
        key: "fzymgc-house/cluster/authelia"
        property: "identity_providers.oidc.hmac.key"
    - secretKey: session_encryption_key
      remoteRef:
        key: "fzymgc-house/cluster/authelia"
        property: "session.encryption.key"
    - secretKey: session_redis_password
      remoteRef:
        key: "fzymgc-house/cluster/valkey/valkey-credentials"
        property: "password"
    - secretKey: storage_postgres_password
      remoteRef:
        key: "fzymgc-house/cluster/postgres/main-authelia"
        property: "password"
    - secretKey: identity_validation_reset_password_jwt_hmac_key
      remoteRef:
        key: "fzymgc-house/cluster/authelia"
        property: "identity_validation.reset_password.jwt.hmac.key"
    - secretKey: storage_encryption_key
      remoteRef:
        key: "fzymgc-house/cluster/authelia"
        property: "storage.encryption.key"
