apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaRuleGroup
metadata:
  name: rg-kubernetes-storage
  namespace: grafana
  labels:
    grafana.integreatly.org/instance: grafana
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  folders:
    - title: Kubernetes
      interval: 1m
      orgId: 1
      rules:
        - title: PVC Pending
          condition: A
          data:
            - refId: A
              datasourceUid: Prometheus
              relativeTimeRange:
                from: 300
                to: 0
              model:
                datasource:
                  type: prometheus
                  uid: Prometheus
                editorMode: code
                expr: sum by(namespace, persistentvolumeclaim) (kube_persistentvolumeclaim_status_phase{phase="Pending"}) > 0
                intervalMs: 60000
                legendFormat: "{{namespace}}/{{persistentvolumeclaim}}"
                maxDataPoints: 43200
                refId: A
          for: 5m
          annotations:
            summary: "PVC stuck in Pending"
          labels:
            severity: warning
          noDataState: NoData
          execErrState: Error


