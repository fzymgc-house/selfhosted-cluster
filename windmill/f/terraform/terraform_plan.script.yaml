summary: Run Terraform plan and store plan artifact in S3
description: Runs terraform plan on a module and uploads the plan file to S3 using WM_JOB_ID for unique storage
lock: '!inline f/terraform/terraform_plan.script.lock'
kind: script
schema:
  $schema: 'https://json-schema.org/draft/2020-12/schema'
  type: object
  properties:
    module_dir:
      type: string
      description: Path to the Terraform module directory
      default: null
      originalType: string
    vault_addr:
      type: string
      description: Vault server address
      default: 'https://vault.fzymgc.house'
      originalType: string
    vault_token:
      type: string
      description: Vault authentication token
      default: ''
      originalType: string
    tfc_token:
      type: string
      description: Terraform Cloud API token (optional)
      default: null
      originalType: string
    s3_resource:
      type: object
      description: S3 resource for storing plan artifacts
      default: null
      format: resource-s3
  required:
    - module_dir
